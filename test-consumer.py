from kafka import KafkaConsumer
import json

# Kafka broker address
bootstrap_servers = 'localhost:9092'  # Update with your Kafka broker address

# Kafka topic to consume from
topic = 'wiki-changes'

# Create Kafka consumer
consumer = KafkaConsumer(
    topic,
    bootstrap_servers=bootstrap_servers,
    value_deserializer=lambda v: json.loads(v.decode('utf-8')),
    auto_offset_reset='earliest',  # Start consuming from the beginning of the topic
    group_id='wiki-consumer-group'  # Consumer group ID
)

# Start consuming messages
try:
    for message in consumer:
        # Print consumed message
        print("Received message:", message.value)
except KeyboardInterrupt:
    print("Consumer stopped")
finally:
    # Close the consumer
    consumer.close()


# {'$schema': '/mediawiki/recentchange/1.0.0', 'meta': {'uri': 'https://en.wikipedia.org/wiki/Simon_Jameson', 'request_id': '9686d1cf-6ee9-4c4b-acf3-a643ccc2dfe6', 'id': 'd5c801d4-16d1-4b2a-b0a2-fcd6ead2e175', 'dt': '2024-05-03T20:28:49Z', 'domain': 'en.wikipedia.org', 'stream': 'mediawiki.recentchange', 'topic': 'eqiad.mediawiki.recentchange', 'partition': 0, 'offset': 5069694334}, 'id': 1772286098, 'type': 'edit', 'namespace': 0, 'title': 'Simon Jameson', 'title_url': 'https://en.wikipedia.org/wiki/Simon_Jameson', 'comment': 'Bot: Fixing double redirect to [[Yes I Can (TV programme)]]', 'timestamp': 1714768129, 'user': 'Xqbot', 'bot': True, 'notify_url': 'https://en.wikipedia.org/w/index.php?diff=1222088605&oldid=532143058', 'minor': True, 'length': {'old': 35, 'new': 38}, 'revision': {'old': 532143058, 'new': 1222088605}, 'server_url': 'https://en.wikipedia.org', 'server_name': 'en.wikipedia.org', 'server_script_path': '/w', 'wiki': 'enwiki', 'parsedcomment': 'Bot: Fixing double redirect to <a href="/wiki/Yes_I_Can_(TV_programme)" title="Yes I Can (TV programme)">Yes I Can (TV programme)</a>'}
# Received message: {'$schema': '/mediawiki/recentchange/1.0.0', 'meta': {'uri': 'https://en.wikipedia.org/wiki/Floyd_Kane', 'request_id': 'ce3cfd26-a271-444a-a4b9-8f8d890f532a', 'id': 'a8a20395-5ea9-407e-8bb1-052cf22afec9', 'dt': '2024-05-03T20:28:49Z', 'domain': 'en.wikipedia.org', 'stream': 'mediawiki.recentchange', 'topic': 'eqiad.mediawiki.recentchange', 'partition': 0, 'offset': 5069694339}, 'id': 1772286100, 'type': 'edit', 'namespace': 0, 'title': 'Floyd Kane', 'title_url': 'https://en.wikipedia.org/wiki/Floyd_Kane', 'comment': 'fill out references (9), tidy links per [[WP:OVERLINK]], general fixes', 'timestamp': 1714768129, 'user': 'Hebrides', 'bot': False, 'notify_url': 'https://en.wikipedia.org/w/index.php?diff=1222088604&oldid=1222087772', 'minor': False, 'length': {'old': 3738, 'new': 5120}, 'revision': {'old': 1222087772, 'new': 1222088604}, 'server_url': 'https://en.wikipedia.org', 'server_name': 'en.wikipedia.org', 'server_script_path': '/w', 'wiki': 'enwiki', 'parsedcomment': 'fill out references (9), tidy links per <a href="/wiki/Wikipedia:OVERLINK" class="mw-redirect" title="Wikipedia:OVERLINK">WP:OVERLINK</a>, general fixes'}
# Received message: {'$schema': '/mediawiki/recentchange/1.0.0', 'meta': {'uri': 'https://en.wikipedia.org/wiki/Glassnote_Records', 'request_id': 'b75a2a18-a5b0-4024-9c50-d79154ee90ac', 'id': 'e52d2f50-9ed9-4a36-9a51-f7158971d12a', 'dt': '2024-05-03T20:28:52Z', 'domain': 'en.wikipedia.org', 'stream': 'mediawiki.recentchange', 'topic': 'eqiad.mediawiki.recentchange', 'partition': 0, 'offset': 5069694398}, 'id': 1772286104, 'type': 'edit', 'namespace': 0, 'title': 'Glassnote Records', 'title_url': 'https://en.wikipedia.org/wiki/Glassnote_Records', 'comment': '/* Current roster */', 'timestamp': 1714768132, 'user': 'Kcarmichael9', 'bot': False, 'notify_url': 'https://en.wikipedia.org/w/index.php?diff=1222088608&oldid=1222088515', 'minor': False, 'length': {'old': 16381, 'new': 16369}, 'revision': {'old': 1222088515, 'new': 1222088608}, 'server_url': 'https://en.wikipedia.org', 'server_name': 'en.wikipedia.org', 'server_script_path': '/w', 'wiki': 'enwiki', 'parsedcomment': '<span dir="auto"><span class="autocomment"><a href="/wiki/Glassnote_Records#Current_roster" title="Glassnote Records">→\u200eCurrent roster</a></span></span>'}
# Received message: {'$schema': '/mediawiki/recentchange/1.0.0', 'meta': {'uri': 'https://en.wikipedia.org/wiki/Emperor_Taish%C5%8D', 'request_id': '336058e0-0d5c-4df6-8c0c-131c123e38c5', 'id': '4c6dbe15-50ad-40c3-a453-b88088c3f642', 'dt': '2024-05-03T20:28:47Z', 'domain': 'en.wikipedia.org', 'stream': 'mediawiki.recentchange', 'topic': 'eqiad.mediawiki.recentchange', 'partition': 0, 'offset': 5069694399}, 'id': 1772286103, 'type': 'edit', 'namespace': 0, 'title': 'Emperor Taishō', 'title_url': 'https://en.wikipedia.org/wiki/Emperor_Taish%C5%8D', 'comment': 'Bad grammar fix', 'timestamp': 1714768127, 'user': '76.21.189.240', 'bot': False, 'notify_url': 'https://en.wikipedia.org/w/index.php?diff=1222088607&oldid=1220700103', 'minor': False, 'length': {'old': 27112, 'new': 27100}, 'revision': {'old': 1220700103, 'new': 1222088607}, 'server_url': 'https://en.wikipedia.org', 'server_name': 'en.wikipedia.org', 'server_script_path': '/w', 'wiki': 'enwiki', 'parsedcomment': 'Bad grammar fix'}
# Received message: {'$schema': '/mediawiki/recentchange/1.0.0', 'meta': {'uri': 'https://en.wikipedia.org/wiki/Willkie_Farr_%26_Gallagher', 'request_id': '6081b7df-c1d2-45d9-88de-689b183c6470', 'id': '6f3e8961-73bc-4b70-8932-5a5ab70520fb', 'dt': '2024-05-03T20:28:51Z', 'domain': 'en.wikipedia.org', 'stream': 'mediawiki.recentchange', 'topic': 'eqiad.mediawiki.recentchange', 'partition': 0, 'offset': 5069694405}, 'id': 1772286105, 'type': 'edit', 'namespace': 0, 'title': 'Willkie Farr & Gallagher', 'title_url': 'https://en.wikipedia.org/wiki/Willkie_Farr_%26_Gallagher', 'comment': 'clean up, replaced: Presidential → presidential (2), [[WP:AWB/T|typo(s) fixed]]: Executive Committee → executive committee, Chairman → chairman, from 1969–1984 → from 1969 to 1984, 1851-1914 → 1851–1914', 'timestamp': 1714768131, 'user': 'WikiEditor50', 'bot': False, 'notify_url': 'https://en.wikipedia.org/w/index.php?diff=1222088606&oldid=1219572121', 'minor': False, 'length': {'old': 26181, 'new': 26184}, 'revision': {'old': 1219572121, 'new': 1222088606}, 'server_url': 'https://en.wikipedia.org', 'server_name': 'en.wikipedia.org', 'server_script_path': '/w', 'wiki': 'enwiki', 'parsedcomment': 'clean up, replaced: Presidential → presidential (2), <a href="/wiki/Wikipedia:AWB/T" class="mw-redirect" title="Wikipedia:AWB/T">typo(s) fixed</a>: Executive Committee → executive committee, Chairman → chairman, from 1969–1984 → from 1969 to 1984, 1851-1914 → 1851–1914'}
# Received message: {'$schema': '/mediawiki/recentchange/1.0.0', 'meta': {'uri': 'https://en.wikipedia.org/wiki/Category:Webarchive_template_wayback_links', 'request_id': '4b7ec5b6-29c4-419d-ba31-d97415ea9bee', 'id': 'd68ac6aa-40be-4708-9b99-a0d831f96d45', 'dt': '2024-05-03T20:28:48Z', 'domain': 'en.wikipedia.org', 'stream': 'mediawiki.recentchange', 'topic': 'eqiad.mediawiki.recentchange', 'partition': 0, 'offset': 5069694435}, 'id': 1772286107, 'type': 'categorize', 'namespace': 14, 'title': 'Category:Webarchive template wayback links', 'title_url': 'https://en.wikipedia.org/wiki/Category:Webarchive_template_wayback_links', 'comment': '[[:Me Him Her]] added to category, [[Special:WhatLinksHere/Me Him Her|this page is included within other pages]]', 'timestamp': 1714768128, 'user': 'Goodmans238', 'bot': False, 'notify_url': 'https://en.wikipedia.org/w/index.php?diff=1222088602&oldid=1221287639', 'server_url': 'https://en.wikipedia.org', 'server_name': 'en.wikipedia.org', 'server_script_path': '/w', 'wiki': 'enwiki', 'parsedcomment': '<a href="/wiki/Me_Him_Her" title="Me Him Her">Me Him Her</a> added to category, <a href="/wiki/Special:WhatLinksHere/Me_Him_Her" title="Special:WhatLinksHere/Me Him Her">this page is included within other pages</a>'}
# Received message: {'$schema': '/mediawiki/recentchange/1.0.0', 'meta': {'uri': 'https://en.wikipedia.org/wiki/String_Quartet_No._12_(Shostakovich)', 'request_id': '8f45578c-eb46-4c87-98f9-d1bfd0f8ba8c', 'id': '194e1b5d-2f4d-4907-b2f8-adab017b16da', 'dt': '2024-05-03T20:28:53Z', 'domain': 'en.wikipedia.org', 'stream': 'mediawiki.recentchange', 'topic': 'eqiad.mediawiki.recentchange', 'partition': 0, 'offset': 5069694470}, 'id': 1772286108, 'type': 'edit', 'namespace': 0, 'title': 'String Quartet No. 12 (Shostakovich)', 'title_url': 'https://en.wikipedia.org/wiki/String_Quartet_No._12_(Shostakovich)', 'comment': 'Reverted [[WP:AGF|good faith]] edits by [[Special:Contributions/135.129.144.126|135.129.144.126]] ([[User talk:135.129.144.126|talk]]): Imprecise? Three times longer in length how? Numbers of measures or in time required to perform (the latter being highly variable)?', 'timestamp': 1714768133, 'user': 'CurryTime7-24', 'bot': False, 'notify_url': 'https://en.wikipedia.org/w/index.php?diff=1222088611&oldid=1222041140', 'minor': False, 'length': {'old': 3142, 'new': 3072}, 'revision': {'old': 1222041140, 'new': 1222088611}, 'server_url': 'https://en.wikipedia.org', 'server_name': 'en.wikipedia.org', 'server_script_path': '/w', 'wiki': 'enwiki', 'parsedcomment': 'Reverted <a href="/wiki/Wikipedia:AGF" class="mw-redirect" title="Wikipedia:AGF">good faith</a> edits by <a href="/wiki/Special:Contributions/135.129.144.126" title="Special:Contributions/135.129.144.126">135.129.144.126</a> (<a href="/wiki/User_talk:135.129.144.126" title="User talk:135.129.144.126">talk</a>): Imprecise? Three times longer in length how? Numbers of measures or in time required to perform (the latter being highly variable)?'}
# Received message: {'$schema': '/mediawiki/recentchange/1.0.0', 'meta': {'uri': 'https://en.wikipedia.org/wiki/Draft:Eurovision_Song_Contest_2025', 'request_id': 'e99ac73f-2fef-4edf-8ba7-ae5cd4d1704f', 'id': '16ae6ffb-c031-424d-affe-b42d07cbe58a', 'dt': '2024-05-03T20:28:52Z', 'domain': 'en.wikipedia.org', 'stream': 'mediawiki.recentchange', 'topic': 'eqiad.mediawiki.recentchange', 'partition': 0, 'offset': 5069694474}, 'id': 1772286109, 'type': 'edit', 'namespace': 118, 'title': 'Draft:Eurovision Song Contest 2025', 'title_url': 'https://en.wikipedia.org/wiki/Draft:Eurovision_Song_Contest_2025', 'comment': '/* EBU members */', 'timestamp': 1714768132, 'user': 'IvanScrooge98', 'bot': False, 'notify_url': 'https://en.wikipedia.org/w/index.php?diff=1222088610&oldid=1222080451', 'minor': False, 'length': {'old': 19521, 'new': 19526}, 'revision': {'old': 1222080451, 'new': 1222088610}, 'server_url': 'https://en.wikipedia.org', 'server_name': 'en.wikipedia.org', 'server_script_path': '/w', 'wiki': 'enwiki', 'parsedcomment': '<span dir="auto"><span class="autocomment"><a href="/wiki/Draft:Eurovision_Song_Contest_2025#EBU_members" title="Draft:Eurovision Song Contest 2025">→\u200eEBU members</a></span></span>'}
# Received message: {'$schema': '/mediawiki/recentchange/1.0.0', 'meta': {'uri': 'https://en.wikipedia.org/wiki/Emma_Doyle_(reality_television_participant)', 'request_id': 'cc938e91-c49f-4125-a289-525a00a91d36', 'id': '8e568a38-afbd-4b0e-8c53-3ddde86892bb', 'dt': '2024-05-03T20:28:54Z', 'domain': 'en.wikipedia.org', 'stream': 'mediawiki.recentchange', 'topic': 'eqiad.mediawiki.recentchange', 'partition': 0, 'offset': 5069694475}, 'id': 1772286110, 'type': 'edit', 'namespace': 0, 'title': 'Emma Doyle (reality television participant)', 'title_url': 'https://en.wikipedia.org/wiki/Emma_Doyle_(reality_television_participant)', 'comment': 'Bot: Fixing double redirect to [[Yes I Can (TV programme)]]', 'timestamp': 1714768134, 'user': 'Xqbot', 'bot': True, 'notify_url': 'https://en.wikipedia.org/w/index.php?diff=1222088612&oldid=949139632', 'minor': True, 'length': {'old': 35, 'new': 38}, 'revision': {'old': 949139632, 'new': 1222088612}, 'server_url': 'https://en.wikipedia.org', 'server_name': 'en.wikipedia.org', 'server_script_path': '/w', 'wiki': 'enwiki', 'parsedcomment': 'Bot: Fixing double redirect to <a href="/wiki/Yes_I_Can_(TV_programme)" title="Yes I Can (TV programme)">Yes I Can (TV programme)</a>'}
# Received message: {'$schema': '/mediawiki/recentchange/1.0.0', 'meta': {'uri': 'https://en.wikipedia.org/wiki/Kokanee_salmon', 'request_id': 'd6d17c7b-29f4-484a-8c2f-fbc09235bcd5', 'id': '56d18065-3bf0-4e96-8475-5a4ca4bef38c', 'dt': '2024-05-03T20:28:53Z', 'domain': 'en.wikipedia.org', 'stream': 'mediawiki.recentchange', 'topic': 'eqiad.mediawiki.recentchange', 'partition': 0, 'offset': 5069694489}, 'id': 1772286111, 'type': 'edit', 'namespace': 0, 'title': 'Kokanee salmon', 'title_url': 'https://en.wikipedia.org/wiki/Kokanee_salmon', 'comment': 'Bolding', 'timestamp': 1714768133, 'user': 'CheeseyHead', 'bot': False, 'notify_url': 'https://en.wikipedia.org/w/index.php?diff=1222088609&oldid=1189776235', 'minor': True, 'length': {'old': 20248, 'new': 20290}, 'revision': {'old': 1189776235, 'new': 1222088609}, 'server_url': 'https://en.wikipedia.org', 'server_name': 'en.wikipedia.org', 'server_script_path': '/w', 'wiki': 'enwiki', 'parsedcomment': 'Bolding'}